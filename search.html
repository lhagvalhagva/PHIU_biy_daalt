<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="css/style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
      integrity="sha512-nd+9MwCQf6Z60dXKJQfz+qC4yr1dE37zTU5oOSDk0bQarhyMQj8Zu1YpXHdjL1+Lq92ZNC4TqL8wuCko70+Q7w=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <title>Drug Search - Pharma Map</title>
  </head>
  <body>
    <header id="header">
      <div class="logo">
        <a href="/search.html">
          <img src="./images/logo.svg" alt="Pharma Map Icon" />
          Pharma Map
        </a>
      </div>
      <div class="hamburger" id="toggle">
        <div class="line"></div>
        <div class="line"></div>
        <div class="line"></div>
      </div>
      <nav class="nav-bar" id="navbar">
        <ul>
          <li><a href="search.html" class="navlogin active">Search</a></li>
          <li><a href="product.html">Products</a></li>
          <li><a href="contact.html">Contact</a></li>
          <li><a href="map.html">Map</a></li>
          <div class="login">
            <li><a href="login.html">Login</a></li>
          </div>
        </ul>
      </nav>
    </header>

    <div class="search-container">
      <h1>Drug Search</h1>
      <form id="search-form">
        <input type="text" id="search-input" placeholder="Enter drug name" />
        <select id="category-select">
          <option value="">All Categories</option>
        </select>

        <button type="submit">Search</button>
      </form>
      <div id="search-results" class="results-container"></div>
    </div>

    <script src="javascript/index.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        fetch("/drug.json")
          .then((response) => {
            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
          })
          .then((data) => {
            const categories = new Set(data.map((drug) => drug.category));
            const categorySelect = document.getElementById("category-select");

            categorySelect.innerHTML = "";

            const allOption = document.createElement("option");
            allOption.value = "";
            allOption.textContent = "All Categories";
            categorySelect.appendChild(allOption);

            categories.forEach((category) => {
              const option = document.createElement("option");
              option.value = category;
              option.textContent = category;
              categorySelect.appendChild(option);
            });
          })
          .catch((error) => {
            console.error("Error fetching categories:", error);
          });
      });

      document
        .getElementById("search-form")
        .addEventListener("submit", function (event) {
          event.preventDefault();
          const searchTerm = document
            .getElementById("search-input")
            .value.toLowerCase();
          const selectedCategory =
            document.getElementById("category-select").value;

          fetch("/drug.json")
            .then((response) => {
              if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
              }
              return response.json();
            })
            .then((data) => {
              let searchResults = data.filter((drug) =>
                drug.name.toLowerCase().includes(searchTerm)
              );

              if (selectedCategory) {
                searchResults = searchResults.filter(
                  (drug) => drug.category === selectedCategory
                );
              }

              displaySearchResults(searchResults);
            })
            .catch((error) => {
              console.error("Error fetching data:", error);
              document.getElementById(
                "search-results"
              ).innerHTML = `<p>Error fetching data: ${error.message}</p>`;
            });
        });

      function displaySearchResults(results) {
        const searchResultsContainer =
          document.getElementById("search-results");
        searchResultsContainer.innerHTML = "";

        if (results.length === 0) {
          searchResultsContainer.innerHTML = "<p>No results found.</p>";
          return;
        }

        results.forEach((result) => {
          const div = document.createElement("div");
          div.classList.add("result-box");

          const img = document.createElement("img");
          img.src = result.image;
          img.alt = result.name;
          div.appendChild(img);

          const detailsDiv = document.createElement("div");
          detailsDiv.classList.add("result-details");

          const namePara = document.createElement("p");
          namePara.textContent = `Name: ${result.name}`;
          detailsDiv.appendChild(namePara);

          const categoryPara = document.createElement("p");
          categoryPara.textContent = `Category: ${result.category}`;
          detailsDiv.appendChild(categoryPara);

          const pricePara = document.createElement("p");
          pricePara.textContent = `Price: ${result.price}`;
          detailsDiv.appendChild(pricePara);

          const positionPara = document.createElement("p");
          positionPara.textContent = `position: ${result.position}`;
          detailsDiv.appendChild(positionPara);

          div.appendChild(detailsDiv);

          div.addEventListener("click", () => {
            window.location.href = `product_detail.html?name=${encodeURIComponent(
              result.name
            )}`;
          });

          searchResultsContainer.appendChild(div);
        });
      }
    </script>
  </body>
</html>
